(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{114:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=o.a.createContext({}),p=function(e){var t=o.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},b=function(e){var t=p(e.components);return o.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),b=p(n),d=a,m=b["".concat(l,".").concat(d)]||b[d]||u[d]||r;return n?o.a.createElement(m,i(i({ref:t},s),{},{components:n})):o.a.createElement(m,i({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,l=new Array(r);l[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var s=2;s<r;s++)l[s]=n[s];return o.a.createElement.apply(null,l)}return o.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},73:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return b}));var a=n(3),o=n(7),r=(n(0),n(114)),l=["components"],i={title:"Synchronization"},c={unversionedId:"syncing",id:"syncing",isDocsHomePage:!1,title:"Synchronization",description:"Because RMRK NFT's are currently logged alongside blocks, but do not change state of the chain, they",source:"@site/docs/syncing.md",slug:"/syncing",permalink:"/syncing",editUrl:"https://github.com/rmrk-team/rmrk-docs/edit/master/website/docs/syncing.md",version:"current",sidebar:"docs",previous:{title:"RMRK 2.0",permalink:"/rmrk2"},next:{title:"EVM",permalink:"/evm"}},s=[{value:"Syncing from scratch",id:"syncing-from-scratch",children:[{value:"Fetch",id:"fetch",children:[]},{value:"Download dumps",id:"download-dumps",children:[]}]},{value:"Consolidation",id:"consolidation",children:[]},{value:"API",id:"api",children:[]}],p={toc:s};function b(e){var t=e.components,n=Object(o.a)(e,l);return Object(r.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Because RMRK NFT's are currently logged alongside blocks, but do not change state of the chain, they\nare not easy to fetch."),Object(r.b)("p",null,"If we have remarks like (paraphrased):"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Alice has 0 apples."),Object(r.b)("li",{parentName:"ul"},"Alice buys 5 apples."),Object(r.b)("li",{parentName:"ul"},"Alice sends Bob 3 apples."),Object(r.b)("li",{parentName:"ul"},"Alice sends Charlie 3 apples.")),Object(r.b)("p",null,"One of the two remarks at the end is invalid because Alice does not have 6 apples."),Object(r.b)("p",null,"If these remarks are not looked at in order and formed into one, single ",Object(r.b)("strong",{parentName:"p"},"consolidated")," state, we\ncannot be sure the operations are legitimate. Because the remarks can happen on different blocks\n(months apart even), fetching them and then consolidating them takes a lot of time you don't have an\nalready synced node, and a pre-consolidated dump which you could simply append to."),Object(r.b)("p",null,"Thus, there are several ways to get up to date with RMRK state."),Object(r.b)("h2",{id:"syncing-from-scratch"},"Syncing from scratch"),Object(r.b)("p",null,"While it's very useful to have a locally running Kusama node at all times for various development\nexperiments, this process is not recommended unless you have a lot of time."),Object(r.b)("p",null,"The full process is:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"run a fetcher on a Kusama node, to get all remarks"),Object(r.b)("li",{parentName:"ul"},'run a consolidator on the fetched output, to get the consolidated set of remarks, and thus the\n"NFT database" in simple JSON file format'),Object(r.b)("li",{parentName:"ul"},"run any operations on this final set, like analytics, burn checks, owner checks, and more.")),Object(r.b)("p",null,"Let's go through it step by step."),Object(r.b)("p",null,"To sync from scratch you will need to be running a local Kusama node. Connecting to a remote one\nwill simply be too slow and usually throttled by the provider. Download a compiled Polkadot release\nfrom ",Object(r.b)("a",{parentName:"p",href:"https://github.com/paritytech/polkadot/releases"},"the releases page")," (or compile from scratch\nif you're feeling adventurous - instructions are in the README), and run it with:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"chmod +x polkadot && mv polkadot kusama\n./kusama --pruning archive --db rocksdb\n")),Object(r.b)("p",null,"If you're running this somewhere in a server of yours and want to connect to it from outside, also\nadd ",Object(r.b)("inlineCode",{parentName:"p"},"--rpc-cors all")," to allow other origins to connect to this server."),Object(r.b)("p",null,"The sync process takes a few days."),Object(r.b)("p",null,"Once the node is synced (the terminal output will let you know), you must fetch the remarks using\n",Object(r.b)("a",{parentName:"p",href:"https://github.com/rmrk-team/rmrk-tools/"},"rmrk-tools"),"."),Object(r.b)("p",null,"Install RMRK tools. You need a modern version of NodeJS and Yarn. We recommend using\n",Object(r.b)("a",{parentName:"p",href:"https://github.com/nvm-sh/nvm"},"NVM")," and setting it to 14.16 or newer."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"yarn install rmrk-tools\n")),Object(r.b)("p",null,"By default, RMRK Tools work with RMRK 2. If you're working with RMRK 1, switch the branch to\n",Object(r.b)("inlineCode",{parentName:"p"},"rmrk-one"),":"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"git fetch && git branch rmrk-one\n")),Object(r.b)("h3",{id:"fetch"},"Fetch"),Object(r.b)("p",null,"Then, run the fetch command on the node:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"yarn cli:fetch --prefixes=0x726d726b,0x524d524b --ws=ws://localhost:9933\n")),Object(r.b)("p",null,"The output is a JSON file of remarks - any message found alongside chain blocks starting with the\nprefixes ",Object(r.b)("inlineCode",{parentName:"p"},"0x726d726b,0x524d524b"),", hex-encoded for ",Object(r.b)("inlineCode",{parentName:"p"},"rmrk,RMRK"),"."),Object(r.b)("p",null,"If you have a previously fetched dump, you can use the ",Object(r.b)("inlineCode",{parentName:"p"},"append")," flag to just append to it and\nshorten the processing time. This is good for cronjobs."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"yarn cli:fetch --prefixes=0x726d726b,0x524d524b --append=QmdDywgAeybKG6erv5tJmzzfADZs19aJQV1PoMDmff6jR5.json --ws=wss://node.rmrk.app --from=8000000 --to=9000000\n")),Object(r.b)("p",null,"Other commands to run:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"--ws URL"),": websocket URL to connecto to, defaults to ",Object(r.b)("inlineCode",{parentName:"li"},"127.0.0.1:9944")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"--from FROM"),": block from which to start, defaults to 0 (note that for RMRK, canonically the block\n4892957 is genesis)"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"--to TO"),": block until which to search, defaults to latest"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"--prefixes PREFIXES"),": limit return data to only remarks with these prefixes. Can be comma\nseparated list. Prefixes can be hex or utf8. Case sensitive. Example: 0x726d726b,0x524d524b"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"--append PATH"),": special mode which takes the last block in an existing dump file + 1 as FROM\n(overrides FROM). Appends new blocks with remarks into that file. Convenient for running via\ncronjob for continuous remark list building. Performance right now is 1000 blocks per 10 seconds,\nso processing 5000 blocks with a ",Object(r.b)("inlineCode",{parentName:"li"},"* * * * *")," cronjob should be doable. Example:\n",Object(r.b)("inlineCode",{parentName:"li"},"yarn cli:fetch --prefixes=0x726d726b,0x524d524b --append=somefile.json")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"--collection"),": filter by specific collection or part of collection ID (i.e. RMRK substring)"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"--fin"),': defaults to "yes" if omitted. When "yes", fetches up to last finalized block if ',Object(r.b)("inlineCode",{parentName:"li"},"to")," is\nomitted. Otherwise, last block. ",Object(r.b)("inlineCode",{parentName:"li"},"no")," is useful for testing."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"--output"),": name of the file into which to save the output. Overridden if ",Object(r.b)("inlineCode",{parentName:"li"},"append")," is used.")),Object(r.b)("h3",{id:"download-dumps"},"Download dumps"),Object(r.b)("p",null,"You can also download both a dump from IPFS."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"https://gateway.pinata.cloud/ipns/latestdump.rmrk.app"},"RMRK 1 full dump")," (updated every 15-20\nminutes)"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"https://gateway.pinata.cloud/ipns/latest-rmrk2.rmrk.link"},"RMRK 2 full dump")," (updated every 15-20\nminutes)  ")),Object(r.b)("h2",{id:"consolidation"},"Consolidation"),Object(r.b)("p",null,"Once you have a fetched set, you need to consolidate it."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"yarn cli:consolidate --json=dump.json  --ws=ws://localhost:9933\n")),Object(r.b)("p",null,"There is also a regularly updated consolidated set available for download for both RMRK 1 and RMRK\n2:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"https://gateway.pinata.cloud/ipns/precon-mkt.rmrk.app"},"RMRK 1 consolidated dump")," - ~400 MB, has\neverything"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"https://gateway.pinata.cloud/ipns/precon-lite.rmrk.link"},"RMRK 1 consolidated dump lite")," - only\n~20 MB, removed burned NFTs and all their emotes"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"https://gateway.pinata.cloud/ipns/precon-rmrk2.rmrk.link"},"RMRK 2 consolidated dump")," - ~100 MB")),Object(r.b)("h2",{id:"api"},"API"),Object(r.b)("p",null,"The RMRK team also offers simple graphql and HTTPs APIs you can query for quick reading of balances\nof any account. Please ",Object(r.b)("a",{parentName:"p",href:"mailto:hack@rmrk.app"},"let us know")," if you'd like to use these APIs."))}b.isMDXComponent=!0}}]);